<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password - Movies App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 pt-20">
    <!-- Include navbar -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto">
            <!-- Page Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-lock text-blue-500 mr-3"></i>Change Password
                </h1>
                <p class="text-gray-600">Update your account password for better security</p>
                <div class="mt-4">
                    <a th:href="@{/profile}" class="text-blue-500 hover:text-blue-700 transition-colors duration-300">
                        <i class="fas fa-arrow-left mr-1"></i>Back to Profile
                    </a>
                </div>
            </div>

            <!-- Success Message -->
            <div th:if="${param.success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-6 relative" role="alert">
                <div class="flex items-center">
                    <i class="fas fa-check-circle mr-2"></i>
                    <div>
                        <strong class="font-bold">Success!</strong>
                        <span class="block sm:inline">Password changed successfully!</span>
                    </div>
                </div>
            </div>
            
            <!-- Error Message -->
            <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-6 relative" role="alert">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <div>
                        <strong class="font-bold">Error!</strong>
                        <span class="block sm:inline" th:text="${error}"></span>
                    </div>
                </div>
            </div>

            <!-- Change Password Form -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-200">
                <!-- User Info Header -->
                <div class="flex items-center mb-8 pb-6 border-b border-gray-200">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-user text-white text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800" th:text="${user.firstName + ' ' + user.lastName}">Full Name</h3>
                        <p class="text-gray-600" th:text="${'@' + user.username}">@username</p>
                        <p class="text-gray-500 text-sm" th:text="${user.email}">email@example.com</p>
                    </div>
                </div>
                
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-key text-blue-500 mr-2"></i>Enter Password Details
                </h2>
                
                <form th:action="@{/change-password}" th:object="${changePassword}" method="post" class="space-y-6">
                    <!-- Current Password -->
                    <div>
                        <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-unlock-alt mr-1 text-blue-500"></i>Current Password
                        </label>
                        <input type="password" 
                               th:field="*{currentPassword}" 
                               th:class="${#fields.hasErrors('currentPassword')} ? 'w-full px-4 py-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all duration-300' : 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-300'"
                               id="currentPassword" 
                               placeholder="Enter your current password"
                               required>
                        <div th:if="${#fields.hasErrors('currentPassword')}" class="mt-2 text-red-600 text-sm">
                            <span th:errors="*{currentPassword}"></span>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-lock mr-1 text-blue-500"></i>New Password
                        </label>
                        <input type="password" 
                               th:field="*{newPassword}" 
                               th:class="${#fields.hasErrors('newPassword')} ? 'w-full px-4 py-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all duration-300' : 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-300'"
                               id="newPassword" 
                               placeholder="Enter new password"
                               minlength="6"
                               required>
                        <div th:if="${#fields.hasErrors('newPassword')}" class="mt-2 text-red-600 text-sm">
                            <span th:errors="*{newPassword}"></span>
                        </div>
                    </div>

                    <!-- Confirm New Password -->
                    <div>
                        <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-lock mr-1 text-blue-500"></i>Confirm New Password
                        </label>
                        <input type="password" 
                               th:field="*{confirmNewPassword}" 
                               th:class="${#fields.hasErrors('confirmNewPassword')} ? 'w-full px-4 py-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition-all duration-300' : 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-300'"
                               id="confirmNewPassword" 
                               placeholder="Confirm new password"
                               minlength="6"
                               required>
                        <div th:if="${#fields.hasErrors('confirmNewPassword')}" class="mt-2 text-red-600 text-sm">
                            <span th:errors="*{confirmNewPassword}"></span>
                        </div>
                    </div>

                    <!-- Password Requirements -->
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-blue-400"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Password Requirements:</strong>
                                </p>
                                <ul class="mt-1 text-sm text-blue-600 list-disc list-inside">
                                    <li>At least 6 characters long</li>
                                    <li>New password must be different from current password</li>
                                    <li>Both new password fields must match</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Security Notice -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-shield-alt text-yellow-400"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    <strong>Security Tips:</strong> Choose a strong password that includes uppercase and lowercase letters, numbers, and special characters. 
                                    Don't use personal information or common words.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        <button type="submit" 
                                class="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 uppercase tracking-wider">
                            <i class="fas fa-save mr-2"></i>Change Password
                        </button>
                        
                        <a th:href="@{/profile}" 
                           class="flex-1 text-center bg-gray-500 text-white font-semibold py-3 px-6 rounded-lg hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 uppercase tracking-wider">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Include navbar scripts -->
    <div th:replace="~{fragments/navbar :: navbar-scripts}"></div>

    <script>
        // Client-side password matching validation
        document.addEventListener('DOMContentLoaded', function() {
            const currentPassword = document.getElementById('currentPassword');
            const newPassword = document.getElementById('newPassword');
            const confirmNewPassword = document.getElementById('confirmNewPassword');
            
            function validatePasswords() {
                // Check if new passwords match
                if (newPassword.value && confirmNewPassword.value) {
                    if (newPassword.value !== confirmNewPassword.value) {
                        confirmNewPassword.setCustomValidity('Passwords do not match');
                    } else {
                        confirmNewPassword.setCustomValidity('');
                    }
                }
                
                // Check if new password is different from current password
                if (currentPassword.value && newPassword.value) {
                    if (currentPassword.value === newPassword.value) {
                        newPassword.setCustomValidity('New password must be different from current password');
                    } else if (newPassword.value === confirmNewPassword.value) {
                        newPassword.setCustomValidity('');
                    }
                }
            }
            
            currentPassword.addEventListener('input', validatePasswords);
            newPassword.addEventListener('input', validatePasswords);
            confirmNewPassword.addEventListener('input', validatePasswords);
        });
    </script>
</body>
</html>